<!doctype html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,shrink-to-fit=no"><title>QUIZ</title><script defer="defer" src="/quiz-game/bundle.js"></script></head><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/><link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet"/><script src="./fbloader.js"></script><script>
  // è®¾ç½® postMessage ç›‘å¬å™¨ï¼Œç”¨äºæ¥æ”¶é…ç½®æ•°æ®
  console.log('ğŸ¯ å¼€å§‹è®¾ç½® postMessage ç›‘å¬å™¨ (Quiz Game)');
  window.addEventListener('message', function(event) {
    console.log('ğŸ“¬ Quiz Game æ”¶åˆ°æ¶ˆæ¯:', event.data);
    if (event.data.type === 'UPDATE_MODULE_DATA') {
      console.log('ğŸ“¨ æ”¶åˆ°æ–°çš„ module data');
      
      // ä¿å­˜åˆ° sessionStorage
      sessionStorage.setItem('customModuleData', JSON.stringify(event.data.data.module_data));
      console.log('ğŸ’¾ æ•°æ®å·²ä¿å­˜åˆ° sessionStorage');
      
      // é€šçŸ¥çˆ¶çª—å£æ•°æ®å·²ä¿å­˜ï¼Œè®©çˆ¶çª—å£é‡æ–°åŠ è½½ iframe
      window.parent.postMessage({ type: 'DATA_SAVED' }, '*');
    }
  });
  console.log('âœ… postMessage ç›‘å¬å™¨è®¾ç½®å®Œæˆ (Quiz Game)');
  </script><script src="/quiz-game/moduleData.js"></script><script>
  // ä¼˜å…ˆä½¿ç”¨ sessionStorage ä¸­çš„æ•°æ®
  const customData = sessionStorage.getItem('customModuleData');
  if (customData) {
    console.log('ğŸ¯ Quiz Game ä½¿ç”¨è‡ªå®šä¹‰ä¸Šä¼ çš„æ•°æ®');
    window.moduleData = JSON.parse(customData);
  } else {
    console.log('ğŸ“¦ Quiz Game ä½¿ç”¨é»˜è®¤ moduleData.js æ•°æ®');
    console.log('window.moduleData', window.moduleData);
    if (window.moduleData && window.moduleData.module_data) {
      window.moduleData = window.moduleData.module_data;
    }
  }

  localStorage.setItem('istestenv', JSON.stringify(true));
  
  // ç­‰å¾… DOM åŠ è½½å®Œæˆåæ£€æŸ¥æ•°æ®
  window.addEventListener('DOMContentLoaded', function() {
    console.log('window.moduleData', window.moduleData);
    
    // æ£€æŸ¥ moduleData æ˜¯å¦å­˜åœ¨ä¸”æœ‰æ•ˆ
    const isDataEmpty = !window.moduleData || 
                        (Array.isArray(window.moduleData) && window.moduleData.length === 0) ||
                        (window.moduleData.module_data && Array.isArray(window.moduleData.module_data) && window.moduleData.module_data.length === 0);
    
    if (isDataEmpty) {
      document.body.innerHTML = '<div style="color: #000; font-size: 24px; text-align: center; display: flex; justify-content: center; align-items: center; height: 100vh;">è¯·å…ˆé…ç½®æ¸¸æˆæ•°æ®</div>';
      console.error('âŒ Quiz Game moduleData ä¸å­˜åœ¨æˆ–ä¸ºç©º');
    } else {
      console.log('âœ… Quiz Game moduleData å·²åŠ è½½:', window.moduleData);
    }
  });
  </script><script>// åˆ¤æ–­æ˜¯å¦ä¸ºå¼€å‘ç¯å¢ƒ
    const isDev = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
    if (isDev) {
      // å¼€å‘ç¯å¢ƒä½¿ç”¨ mock æ–‡ä»¶
      document.write('<script src="/quiz-game/js/mock/fbinstant.7.1.mock.js"><\/script>');
    } else {
      // ç”Ÿäº§ç¯å¢ƒä½¿ç”¨çœŸå® FB SDK
      document.write('<script src="https://connect.facebook.net/en_US/fbinstant.7.1.js"><\/script>');
    }</script><body><div id="root"></div><script>window.global ||= window
  
      window._onProgress = true
      async function updateProgress() {
        console.log(FBInstant, 'FBInstant.....')
        let progress = 1
        while (progress < 100) {
          if (window._onProgress === false) {
            progress = 100
            FBInstant.setLoadingProgress(progress)
          } else {
            progress += Math.ceil(10 * Math.random())
            FBInstant.setLoadingProgress(Math.min(progress, 100))
            await new Promise((res) => setTimeout(res, 200))
          }
        }
      }
      // console.log(FBInstant, 'FBInstant.....22222')
      updateProgress()
      window.FBInstantPromise = FBInstant.initializeAsync()
      window.gameStartPromise = window.FBInstantPromise.then(() => {
        return FBInstant.startGameAsync()
      })
      // console.log(FBInstant, 'FBInstant.....33333')
      window.onFBInstantInited = () => window.FBInstantPromise
      window.onFBGameStarted = () => window.gameStartPromise
  
  
      // const script = document.createElement('script');
      // script.src = 'https://cdnjs.cloudflare.com/ajax/libs/eruda/3.4.1/eruda.min.js';
      // script.onload = () => eruda.init();
      // document.body.appendChild(script);</script></body></html>